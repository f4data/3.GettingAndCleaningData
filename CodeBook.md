# CodeBook for Course_03_ProjectAssignment_01
F. Garcia  
Thursday, April 23, 2015  

This document describes the steps followed and the source code used to get and clean the data described in the Project for the Getting and Cleaning Data Course, as well as the variables used on the analysis output.

The analysis is based on the data obtained from Samsung wearables. The goal is to obtain a tidy data set.


## Data
The data is provided in the following url (https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip). 
It contains two sets of data: train and test.   
Each set of data contains a list of 561 values. 
The values have been measured doing 6 different. 
The activities have been performed by 30 different subjects. 


## Variables used
The tidy data contains the following variables: 

 1. **subject**: ID of the subject for the observation: 
 
        - 1..30
        
 2. **activity**: Factor describing the activity: 
 
        - WALKING, 
        - WALKING_UPSTAIRS, 
        - WALKING_DOWNSTAIRS, 
        - SITTING, 
        - STANDING, 
        - LAYING
        
 3. **signal**: Parameter measured:
 
        - "fBodyAcc"            
        - "fBodyAccJerk"         
        - "fBodyAccMag"          
        - "fBodyBodyAccJerkMag"  
        - "fBodyBodyGyroJerkMag"  
        - "fBodyBodyGyroMag"    
        - "fBodyGyro"            
        - "tBodyAcc"             
        - "tBodyAccJerk"         
        - "tBodyAccJerkMag"      
        - "tBodyAccMag"          
        - "tBodyGyro"           
        - "tBodyGyroJerk"        
        - "tBodyGyroJerkMag"     
        - "tBodyGyroMag"         
        - "tGravityAcc"          
        - "tGravityAccMag" 
        
 4. **axis**: For the 3-dimensional signals the axis where the measurement was performed:  
 
        - X  
        - Y  
        - Z  
              
 5. **mean**: Mean value of the mean measurement  
 
 6. **std**: Mean value of the std measurement  
 
## Transformations
Following the detailed steps to obtain a reproducible transformation are explained.

### Load the data
First of all the data is downloaded and extracted.


```r
## Required libraries
suppressPackageStartupMessages(library(dplyr, quietly=TRUE))
library(tidyr)

## Get the source data and extract it
if (!file.exists("UCI HAR Dataset"))
{
        download.file(url = "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip", destfile = "data.zip")
        unzip("data.zip")
}
```

### Merge the data from Test and Training

The data is loaded into memory and 3 different datasets are created. However the 3 of them contain the merged data from train and test.


```r
subject_train <- read.table(".\\UCI HAR Dataset\\train\\subject_train.txt", header=FALSE)
y_train <- read.table(".\\UCI HAR Dataset\\train\\y_train.txt", header=FALSE)
x_train <- read.table(".\\UCI HAR Dataset\\train\\X_train.txt", header=FALSE)

subject_test <- read.table(".\\UCI HAR Dataset\\test\\subject_test.txt", header=FALSE)
y_test <- read.table(".\\UCI HAR Dataset\\test\\y_test.txt", header=FALSE)
x_test <- read.table(".\\UCI HAR Dataset\\test\\X_test.txt", header=FALSE)

dataset_subject <- bind_rows(subject_train, subject_test)
dataset_y <- bind_rows(y_train, y_test)
dataset_x <- bind_rows(x_train, x_test)
```


```r
str(dataset_subject)
```

```
## Classes 'tbl_df', 'tbl' and 'data.frame':	10299 obs. of  1 variable:
##  $ V1: int  1 1 1 1 1 1 1 1 1 1 ...
```

```r
str(dataset_y)
```

```
## Classes 'tbl_df', 'tbl' and 'data.frame':	10299 obs. of  1 variable:
##  $ V1: int  5 5 5 5 5 5 5 5 5 5 ...
```

```r
str(dataset_x)
```

```
## Classes 'tbl_df', 'tbl' and 'data.frame':	10299 obs. of  561 variables:
##  $ V1  : num  0.289 0.278 0.28 0.279 0.277 ...
##  $ V2  : num  -0.0203 -0.0164 -0.0195 -0.0262 -0.0166 ...
##  $ V3  : num  -0.133 -0.124 -0.113 -0.123 -0.115 ...
##  $ V4  : num  -0.995 -0.998 -0.995 -0.996 -0.998 ...
##  $ V5  : num  -0.983 -0.975 -0.967 -0.983 -0.981 ...
##  $ V6  : num  -0.914 -0.96 -0.979 -0.991 -0.99 ...
##  $ V7  : num  -0.995 -0.999 -0.997 -0.997 -0.998 ...
##  $ V8  : num  -0.983 -0.975 -0.964 -0.983 -0.98 ...
##  $ V9  : num  -0.924 -0.958 -0.977 -0.989 -0.99 ...
##  $ V10 : num  -0.935 -0.943 -0.939 -0.939 -0.942 ...
##  $ V11 : num  -0.567 -0.558 -0.558 -0.576 -0.569 ...
##  $ V12 : num  -0.744 -0.818 -0.818 -0.83 -0.825 ...
##  $ V13 : num  0.853 0.849 0.844 0.844 0.849 ...
##  $ V14 : num  0.686 0.686 0.682 0.682 0.683 ...
##  $ V15 : num  0.814 0.823 0.839 0.838 0.838 ...
##  $ V16 : num  -0.966 -0.982 -0.983 -0.986 -0.993 ...
##  $ V17 : num  -1 -1 -1 -1 -1 ...
##  $ V18 : num  -1 -1 -1 -1 -1 ...
##  $ V19 : num  -0.995 -0.998 -0.999 -1 -1 ...
##  $ V20 : num  -0.994 -0.999 -0.997 -0.997 -0.998 ...
##  $ V21 : num  -0.988 -0.978 -0.965 -0.984 -0.981 ...
##  $ V22 : num  -0.943 -0.948 -0.975 -0.986 -0.991 ...
##  $ V23 : num  -0.408 -0.715 -0.592 -0.627 -0.787 ...
##  $ V24 : num  -0.679 -0.501 -0.486 -0.851 -0.559 ...
##  $ V25 : num  -0.602 -0.571 -0.571 -0.912 -0.761 ...
##  $ V26 : num  0.9293 0.6116 0.273 0.0614 0.3133 ...
##  $ V27 : num  -0.853 -0.3295 -0.0863 0.0748 -0.1312 ...
##  $ V28 : num  0.36 0.284 0.337 0.198 0.191 ...
##  $ V29 : num  -0.0585 0.2846 -0.1647 -0.2643 0.0869 ...
##  $ V30 : num  0.2569 0.1157 0.0172 0.0725 0.2576 ...
##  $ V31 : num  -0.2248 -0.091 -0.0745 -0.1553 -0.2725 ...
##  $ V32 : num  0.264 0.294 0.342 0.323 0.435 ...
##  $ V33 : num  -0.0952 -0.2812 -0.3326 -0.1708 -0.3154 ...
##  $ V34 : num  0.279 0.086 0.239 0.295 0.44 ...
##  $ V35 : num  -0.4651 -0.0222 -0.1362 -0.3061 -0.2691 ...
##  $ V36 : num  0.4919 -0.0167 0.1739 0.4821 0.1794 ...
##  $ V37 : num  -0.191 -0.221 -0.299 -0.47 -0.089 ...
##  $ V38 : num  0.3763 -0.0134 -0.1247 -0.3057 -0.1558 ...
##  $ V39 : num  0.4351 -0.0727 -0.1811 -0.3627 -0.1898 ...
##  $ V40 : num  0.661 0.579 0.609 0.507 0.599 ...
##  $ V41 : num  0.963 0.967 0.967 0.968 0.968 ...
##  $ V42 : num  -0.141 -0.142 -0.142 -0.144 -0.149 ...
##  $ V43 : num  0.1154 0.1094 0.1019 0.0999 0.0945 ...
##  $ V44 : num  -0.985 -0.997 -1 -0.997 -0.998 ...
##  $ V45 : num  -0.982 -0.989 -0.993 -0.981 -0.988 ...
##  $ V46 : num  -0.878 -0.932 -0.993 -0.978 -0.979 ...
##  $ V47 : num  -0.985 -0.998 -1 -0.996 -0.998 ...
##  $ V48 : num  -0.984 -0.99 -0.993 -0.981 -0.989 ...
##  $ V49 : num  -0.895 -0.933 -0.993 -0.978 -0.979 ...
##  $ V50 : num  0.892 0.892 0.892 0.894 0.894 ...
##  $ V51 : num  -0.161 -0.161 -0.164 -0.164 -0.167 ...
##  $ V52 : num  0.1247 0.1226 0.0946 0.0934 0.0917 ...
##  $ V53 : num  0.977 0.985 0.987 0.987 0.987 ...
##  $ V54 : num  -0.123 -0.115 -0.115 -0.121 -0.122 ...
##  $ V55 : num  0.0565 0.1028 0.1028 0.0958 0.0941 ...
##  $ V56 : num  -0.375 -0.383 -0.402 -0.4 -0.4 ...
##  $ V57 : num  0.899 0.908 0.909 0.911 0.912 ...
##  $ V58 : num  -0.971 -0.971 -0.97 -0.969 -0.967 ...
##  $ V59 : num  -0.976 -0.979 -0.982 -0.982 -0.984 ...
##  $ V60 : num  -0.984 -0.999 -1 -0.996 -0.998 ...
##  $ V61 : num  -0.989 -0.99 -0.992 -0.981 -0.991 ...
##  $ V62 : num  -0.918 -0.942 -0.993 -0.98 -0.98 ...
##  $ V63 : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
##  $ V64 : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
##  $ V65 : num  0.114 -0.21 -0.927 -0.596 -0.617 ...
##  $ V66 : num  -0.59042 -0.41006 0.00223 -0.06493 -0.25727 ...
##  $ V67 : num  0.5911 0.4139 0.0275 0.0754 0.2689 ...
##  $ V68 : num  -0.5918 -0.4176 -0.0567 -0.0858 -0.2807 ...
##  $ V69 : num  0.5925 0.4213 0.0855 0.0962 0.2926 ...
##  $ V70 : num  -0.745 -0.196 -0.329 -0.295 -0.167 ...
##  $ V71 : num  0.7209 0.1253 0.2705 0.2283 0.0899 ...
##  $ V72 : num  -0.7124 -0.1056 -0.2545 -0.2063 -0.0663 ...
##  $ V73 : num  0.7113 0.1091 0.2576 0.2048 0.0671 ...
##  $ V74 : num  -0.995 -0.834 -0.705 -0.385 -0.237 ...
##  $ V75 : num  0.996 0.834 0.714 0.386 0.239 ...
##  $ V76 : num  -0.996 -0.834 -0.723 -0.387 -0.241 ...
##  $ V77 : num  0.992 0.83 0.729 0.385 0.241 ...
##  $ V78 : num  0.57 -0.831 -0.181 -0.991 -0.408 ...
##  $ V79 : num  0.439 -0.866 0.338 -0.969 -0.185 ...
##  $ V80 : num  0.987 0.974 0.643 0.984 0.965 ...
##  $ V81 : num  0.078 0.074 0.0736 0.0773 0.0734 ...
##  $ V82 : num  0.005 0.00577 0.0031 0.02006 0.01912 ...
##  $ V83 : num  -0.06783 0.02938 -0.00905 -0.00986 0.01678 ...
##  $ V84 : num  -0.994 -0.996 -0.991 -0.993 -0.996 ...
##  $ V85 : num  -0.988 -0.981 -0.981 -0.988 -0.988 ...
##  $ V86 : num  -0.994 -0.992 -0.99 -0.993 -0.992 ...
##  $ V87 : num  -0.994 -0.996 -0.991 -0.994 -0.997 ...
##  $ V88 : num  -0.986 -0.979 -0.979 -0.986 -0.987 ...
##  $ V89 : num  -0.993 -0.991 -0.987 -0.991 -0.991 ...
##  $ V90 : num  -0.985 -0.995 -0.987 -0.987 -0.997 ...
##  $ V91 : num  -0.992 -0.979 -0.979 -0.992 -0.992 ...
##  $ V92 : num  -0.993 -0.992 -0.992 -0.99 -0.99 ...
##  $ V93 : num  0.99 0.993 0.988 0.988 0.994 ...
##  $ V94 : num  0.992 0.992 0.992 0.993 0.993 ...
##  $ V95 : num  0.991 0.989 0.989 0.993 0.986 ...
##  $ V96 : num  -0.994 -0.991 -0.988 -0.993 -0.994 ...
##  $ V97 : num  -1 -1 -1 -1 -1 ...
##  $ V98 : num  -1 -1 -1 -1 -1 ...
##  $ V99 : num  -1 -1 -1 -1 -1 ...
##   [list output truncated]
```

### Extract Mean and deviation for each measurement
The variable names have to be loaded and labeled.  
Once they are labeled we can proceed to filter the different variable names in search for what we want to *select*.  
In our case we will select the features that contain "mean()" and "std()" in the name.

```r
features <- read.table(".\\UCI HAR Dataset\\features.txt", header=FALSE)

names(features) <- c("id","name")
names(dataset_subject) <- "subject"

names(dataset_x) <- as.character(features$name)

dataset_x <- dataset_x[,grepl("mean()", colnames(dataset_x), fixed=TRUE) | grepl("std()", colnames(dataset_x), fixed=TRUE)]
```

### Use descriptive activity Names for the data set
The description given in the "activity_labels.txt" file is self explanatory for every feature.  
The dataset_y is labeled. It only contains the activity, previously the id and now the name extracted from activities.


```r
activities <- read.table(".\\UCI HAR Dataset\\activity_labels.txt", header=FALSE)

names(activities) <- c("id","name")

names(dataset_y) <- "activity"

dataset_y$activity <- activities[dataset_y$activity,]$name

str(activities)
```

```
## 'data.frame':	6 obs. of  2 variables:
##  $ id  : int  1 2 3 4 5 6
##  $ name: Factor w/ 6 levels "LAYING","SITTING",..: 4 6 5 2 3 1
```

### Label the data set with descriptive variable names.
Every single dataset has already been labeled. LetÂ´s bind them together into a single one labeled.


```r
dataset <- bind_cols(dataset_subject, dataset_y, dataset_x)
```

### Create an independent tidy data set
To create a tidy dataset we are going to carry out the following transformations:  
        1. Replace the parenthesis to avoid having them later inside the variable name.  
        2. Group the dataset by subject and then activity  
        3. Sort by subject and then activity  
        4. Compute the mean for every variable  
        5. Convert all the variables into a value of "signal"  
        6. From "signal"" extract the name of the signal, the type of measurement (mean, std) and the axis. When no Axis exists NA will be specified  
        7. Spread the value into 2 values: mean() and std()  



```r
dataset <- tbl_df(dataset)
names(dataset) <- gsub(pattern = "\\(\\)", replacement = "", names(dataset))

tidy_ds <- dataset %>%
        group_by(subject, activity) %>%
        arrange(subject, activity) %>%
        summarise_each(funs(mean)) %>%
        gather(signal, value, -subject, -activity) %>%
        separate(signal, into=c("signal", "variable", "axis"), sep="\\-", extra="drop") %>%
        spread(variable, value)
```

This is the how our data looks like:

```
## Source: local data frame [5,940 x 6]
## 
##    subject activity               signal axis       mean        std
## 1        1   LAYING             fBodyAcc    X -0.9390991 -0.9244374
## 2        1   LAYING             fBodyAcc    Y -0.8670652 -0.8336256
## 3        1   LAYING             fBodyAcc    Z -0.8826669 -0.8128916
## 4        1   LAYING         fBodyAccJerk    X -0.9570739 -0.9641607
## 5        1   LAYING         fBodyAccJerk    Y -0.9224626 -0.9322179
## 6        1   LAYING         fBodyAccJerk    Z -0.9480609 -0.9605870
## 7        1   LAYING          fBodyAccMag   NA -0.8617676 -0.7983009
## 8        1   LAYING  fBodyBodyAccJerkMag   NA -0.9333004 -0.9218040
## 9        1   LAYING fBodyBodyGyroJerkMag   NA -0.9423669 -0.9326607
## 10       1   LAYING     fBodyBodyGyroMag   NA -0.8621902 -0.8243194
## ..     ...      ...                  ...  ...        ...        ...
```

### Save the data
Finally the data is exported to a text file called "analysis_output.txt". This file can be found in this repository as well.


```r
write.table(tidy_ds, file="analysis_output.txt", row.name=FALSE)
```

